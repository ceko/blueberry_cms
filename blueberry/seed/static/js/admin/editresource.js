// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  (function($, window) {
    var BerryBlock, BerryPanel;
    BerryPanel = (function() {

      BerryPanel.hover_class = 'hover';

      BerryPanel.add_block_class = 'berry_add_block';

      function BerryPanel($element) {
        var _this = this;
        this.$element = $element;
        this.blocks = [];
        this.$element.find('.berry_edit_block').each(function(idx, el) {
          return _this.blocks.push(new BerryBlock($(el)));
        });
        this._attach_listeners();
      }

      BerryPanel.prototype._attach_listeners = function() {
        var _this = this;
        this.$element.mouseover(function() {
          return _this.$element.addClass(BerryPanel.hover_class);
        }).mouseout(function() {
          return _this.$element.removeClass(BerryPanel.hover_class);
        });
        return this.$element.find("." + BerryPanel.add_block_class).colorbox(window.bb_cms.colorbox_defaults);
      };

      return BerryPanel;

    })();
    BerryBlock = (function() {

      BerryBlock.hover_class = 'hover';

      function BerryBlock($element) {
        this.$element = $element;
        this._delete = __bind(this._delete, this);

        this._edit = __bind(this._edit, this);

        this._attach_listeners();
        this.id = this.$element.attr('block_id');
      }

      BerryBlock.prototype.show_menu = function(event) {
        var deleteoption, editoption;
        if (!this.clickmenu) {
          editoption = new window.bb_cms.MenuWidgetItem("edit", this._edit);
          deleteoption = new window.bb_cms.MenuWidgetItem("delete", this._delete);
          this.clickmenu = new window.bb_cms.MenuWidget(this.$element, [editoption, deleteoption]);
        }
        window.bb_cms.MenuWidget.hide_all();
        return this.clickmenu.show(event);
      };

      BerryBlock.prototype._edit = function() {
        var colorbox_settings;
        colorbox_settings = window.bb_cms.colorbox_defaults;
        colorbox_settings['href'] = "edit-block/" + this.id;
        return $.colorbox(window.bb_cms.colorbox_defaults);
      };

      BerryBlock.prototype._delete = function() {
        if (confirm("Are you sure?")) {
          return window.location = window.location + ("delete-block/" + this.id);
        }
      };

      BerryBlock.prototype._attach_listeners = function() {
        var _this = this;
        return this.$element.mouseover(function() {
          return _this.$element.addClass(BerryBlock.hover_class);
        }).mouseout(function() {
          return _this.$element.removeClass(BerryBlock.hover_class);
        }).click(function(event) {
          return _this.show_menu(event);
        });
      };

      return BerryBlock;

    })();
    $(function() {
      return $('.berry_edit_panel').each(function(idx, el) {
        return el.BerryPanel = new BerryPanel($(this));
      });
    });
    window.bb_cms || (window.bb_cms = {});
    window.bb_cms.BerryPanel = BerryPanel;
    window.bb_cms.BerryBlock = BerryBlock;
    return window.bb_cms.colorbox_defaults = {
      iframe: true,
      width: "300px",
      height: "400px"
    };
  })(jQuery, window);

}).call(this);
